%!TEX TS-program = XeLaTeX
%!TEX encoding = UTF-8 Unicode

\documentclass[twoside]{article}

% Minimal fontspec definitions
\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{Minion Pro}
\setsansfont[Ligatures=TeX]{Scala Sans Pro}
\setmonofont[Scale=MatchLowercase]{Menlo}
\frenchspacing

% Make twoside setting into a more convenient conditional, for fullwidth and floatrow.
\newif\ifduplex
\makeatletter
  \if@twoside\duplextrue\fi
\makeatother

% Two known fullwidth solutions, via Marco Daniel and Kevin Godby:
%     http://tex.stackexchange.com/questions/34368/how-to-switch-between-two-margin-sizes
% The `fullwidth` / `mdframed` packages work great with text, but cannot be
% wrapped around images and figures, which is less useful in pandoc markdown.
% Therefore, Kevin's Tufte-LaTeX route was preferred.

\usepackage[strict]{changepage}% provides the adjustwidth environment
\usepackage{multicol}% for multiple columns inside the fullwidth environment

% The following definitions should be used *after* any changes to the margins and
% page layout are made (e.g., after geometry). They are used *both* here and in floatrow.
\newlength{\overhang}
  \setlength{\overhang}{\marginparwidth}
  \addtolength{\overhang}{\marginparsep}
\newlength{\fullmeasure}
  \setlength{\fullmeasure}{\textwidth}
  \addtolength{\fullmeasure}{\overhang}

% A fullwidth environment
\newenvironment{fullwidth}{%
  \begin{adjustwidth\ifduplex*\fi}{}{-\overhang}}{%
  \end{adjustwidth\ifduplex*\fi}}

% Caption and floatrow packages redefine tables and figures. In particular,
% I put sans serif captions in the margins for oneside and twoside layout.  
% The documentation for floatrow is atrocious, but it does what it says if you
% can parse it. One does hope the package routines are not as inefficient!

\usepackage[font={footnotesize,sf},labelfont=bf,labelsep=period]{caption}
\usepackage{floatrow}

\captionsetup[capbesidefloat]{justification=raggedright,singlelinecheck=false}
\DeclareMarginSet{outside}{\ifduplex\setfloatmargins*{}{\hskip-\overhang}\fi}
\DeclareFloatSeparators{marginparsep}{\hskip\marginparsep}
\floatsetup[figure]{margins=outside,floatwidth=\textwidth,%
  capposition=beside,capbesideposition={top,outside},\ifduplex facing=yes,\fi%
  capbesidewidth=\marginparwidth,capbesidesep=marginparsep}

% Put footnotes in the margins as well. Note that footmisc needs hyperref links
% to notes switched off, eg: \usepackage[hyperfootnotes=false,...]{hyperref}
\usepackage[side,flushmargin,multiple]{footmisc}
  \renewcommand{\footnotelayout}{\sffamily\raggedright}
%  \renewcommand{\multfootsep}{\symbol{"02D9}}
% for Esipnosa Nova; might want to borrow a superscript comma from Minion Pro or something
\usepackage{marginfix}% recommended I don't quite remember where; improves note placement

% Packages to show what's happening
\usepackage{lipsum}
\usepackage{showframe}

\title{Brief Article}
\author{The Author}
%\date{}

\begin{document}
\maketitle

\lipsum[1]

\begin{fullwidth}
  \begin{multicols}{2}
    \lipsum[2]
  \end{multicols}
  \begin{figure}[htbp]
    \centering
    \includegraphics{./logo.png}
    \caption{An image and a caption}
  \end{figure}
\end{fullwidth}

\lipsum[3-4]

\begin{figure}[htbp]
\centering
\includegraphics{./logo.png}
\caption{Same image again, in standard pandoc output. It comes from the \TeX\ Stack Exchange.}
\end{figure}

\lipsum[5]

Here are short footnote references,\footnote{Here is the first footnote.}\footnote{Here is the second.} and another long one.\footnote{Here's one with multiple paragraphs.

  In pandoc markdown, subsequent paragraphs are indented to show
  that they belong to the previous footnote.

  The whole paragraph can be indented, or just the first line. In this
  way, multi-paragraph footnotes work like multi-paragraph list items.}

This paragraph isn't be part of the note, because it isn't indented in pandoc.

\end{document}