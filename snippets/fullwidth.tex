%!TEX TS-program = XeLaTeX
%!TEX encoding = UTF-8 Unicode

\documentclass[twoside]{article}

% Minimal fontspec definitions
\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{Minion Pro}
\setsansfont[Ligatures=TeX]{Scala Sans Pro}
\setmonofont[Scale=MatchLowercase]{Nitti}
\frenchspacing

% Set captions in sans serif (and sans package; see ยง3 in `texdoc ccaption`)
\makeatletter\renewcommand{\fnum@figure}[1]{\sffamily\footnotesize\textbf{\figurename~\thefigure}.}
\renewcommand{\fnum@table}[1]{\sffamily\footnotesize\textbf{\tablename~\thetable}.}
% reference \@makecaption in /usr/local/texlive/2012/texmf-dist/source/latex/base/classes.dtx
%\setlength\abovecaptionskip{0\p@}
\renewcommand{\@makecaption}[2]{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{#1: #2}%
  \ifdim \wd\@tempboxa >\hsize
    #1: #2\par
  \else
    \global \@minipagefalse
    \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}
\makeatother

% Put standard figure and table captions in the margin
\usepackage[top]{mcaption}
% Bake margincap into all figures 
\let\oldfigure\figure
\let\endoldfigure\endfigure
\renewenvironment{figure}[1][]{%
  \oldfigure[#1]\begin{margincap}}{%
  \end{margincap}\endoldfigure}
% Bake margincap into all tables
\let\oldtable\table% cf http://www.faqoverflow.com/tex/6033.html
\let\endoldtable\endtable
\renewenvironment{table}[1][ht]{%
  \oldtable[#1]\begin{margincap}}{%
  \end{margincap}\endoldtable}

% Call longtable and put its captions in the margin (TK)
\usepackage{longtable}
% For mod ideas see texdoc ccaption at ยง5.5, and http://tex.stackexchange.com/a/96025
%\makeatletter
%\def\LT@makecaption#1#2#3{%
%  \LT@mcol\LT@cols c{\hb@xt@ \z@{\hss\parbox[t]\LTcapwidth{%
%    \sbox\@tempboxa{#1{{\@contnfont #2\@contdelim}}\@conttfont #3}%
%    \ifdim\wd\@tempboxa>\hsize
%      #1{{\@contnfont #2\@contdelim}}\@conttfont #3%
%    \else
%      \hb@xt@ \hsize{\hfil\box\@tempboxa\hfil}%
%    \fi
%    \endgraf\vskip\belowcaptionskip}%
%  \hss}}}
%\makeatother 

% Put footnotes in the margins as well. Note that footmisc needs hyperref links
% to notes switched off, eg: \usepackage[hyperfootnotes=false,...]{hyperref}
\usepackage[side,multiple]{footmisc}
\usepackage{marginfix}
% Place fn mark in paragraph, and mark as tables and figures (bold + period).
\makeatletter
  \renewcommand\@makefntext[1]{%
  \sffamily\raggedright\parindent=1em\noindent
  {}{\bfseries\@thefnmark.}~#1}%
\makeatother

% Packages to show what's happening
\usepackage{lipsum}
\usepackage{showframe}

\title{Brief Article}
\author{The Author}
%\date{}

\begin{document}
\maketitle

\lipsum[1-2]

\begin{figure}[htbp]
  \centering
  \includegraphics{./logo.png}
  \caption{An image and a caption}
\end{figure}

\lipsum[3-4]

\begin{figure}[htbp]
\centering
\includegraphics{./logo.png}
\caption{Same image again, in standard pandoc output. It comes from the \TeX\ Stack Exchange. It has such a long caption that it spills to two lines even in the main \texttt{textwidth} section.}
\end{figure}

\lipsum[5-7]

Here are short footnote references,\footnote{Here is the first footnote.}\footnote{Here is the second.} and another long one.

This paragraph isn't be part of the note, because it isn't indented in pandoc.

\begin{table}
    \centering
    \begin{tabular}{rrrrrrrrr}
        1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\
        1 & 1 & 1 & 1 & 1 & 1 & 1 & 1
    \end{tabular}
    \caption{Caption of the normal \texttt{table} environment.}
    \label{table}
\end{table}

\begin{longtable}{rrrrrrrrr}
    1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\
    1 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\
    \caption{Caption of the \texttt{longtable} environment.}
    \label{longtable}
\end{longtable}

\begin{longtable}[c]{@{}clrl@{}} % standard output from pandoc markdown input
\hline\noalign{\medskip}
\begin{minipage}[b]{0.17\columnwidth}\centering
Centered Header
\end{minipage} & \begin{minipage}[b]{0.11\columnwidth}\raggedright
Default Aligned
\end{minipage} & \begin{minipage}[b]{0.22\columnwidth}\raggedleft
Right Aligned
\end{minipage} & \begin{minipage}[b]{0.35\columnwidth}\raggedright
Left Aligned
\end{minipage}
\\\noalign{\medskip}
\hline\noalign{\medskip}
\begin{minipage}[t]{0.17\columnwidth}\centering
First
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
row
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedleft
12.0
\end{minipage} & \begin{minipage}[t]{0.35\columnwidth}\raggedright
Example of a row that spans multiple lines.
\end{minipage}
\\\noalign{\medskip}
\begin{minipage}[t]{0.17\columnwidth}\centering
Second
\end{minipage} & \begin{minipage}[t]{0.11\columnwidth}\raggedright
row
\end{minipage} & \begin{minipage}[t]{0.22\columnwidth}\raggedleft
5.0
\end{minipage} & \begin{minipage}[t]{0.35\columnwidth}\raggedright
Here's another one. Note the blank line between rows.
\end{minipage}
\\\noalign{\medskip}
\hline
\noalign{\medskip}
\caption{Here's the caption. In pandoc markdown it, too, may span multiple lines.}
\end{longtable}

\lipsum[1]

\end{document}